<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Architect Pro - Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;700&family=Lora:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- CORE STYLES & SETUP --- */
        :root { --accent-color: #4f46e5; }
        html { font-size: 16px; scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .font-lora { font-family: 'Lora', serif; }
        .font-roboto-mono { font-family: 'Roboto Mono', monospace; }
        .accent-bg { background-color: var(--accent-color); }
        .accent-text { color: var(--accent-color); }
        .accent-border { border-color: var(--accent-color); }
        .accent-ring:focus { --tw-ring-color: var(--accent-color); }
        .a4-preview-wrapper { width: 100%; }
        .a4-preview { width: 800px; /* Fixed width for scaling */ aspect-ratio: 210 / 297; box-shadow: 0 10px 30px rgba(0,0,0,0.1); transform-origin: top left;}
        #print-area { display: none; }

        /* --- Drag & Drop Styles --- */
        .list-item-header { display: flex; justify-content: space-between; align-items: center; }
        .drag-handle { cursor: grab; color: #9ca3af; }
        .drag-handle:active { cursor: grabbing; }
        .list-item.dragging { opacity: 0.5; background: #e0e7ff; }

        /* --- Mobile Overlay --- */
        #mobile-overlay.active {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
        }

        /* --- Theme Preview Styles --- */
        .theme-preview-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .theme-preview { border: 2px solid #e5e7eb; border-radius: 0.5rem; padding: 0.75rem; cursor: pointer; transition: all 0.2s ease-in-out; }
        .theme-preview:hover { border-color: var(--accent-color); transform: translateY(-2px); }
        .theme-preview.active { border-color: var(--accent-color); box-shadow: 0 0 0 2px var(--accent-color); }
        .theme-preview .title { font-weight: 600; text-align: center; margin-bottom: 0.5rem; }
        .theme-preview .bar { background-color: #d1d5db; height: 6px; border-radius: 99px; }
        .theme-preview .accent-bar { background-color: var(--accent-color); width: 60%; }

        /* --- PRINT STYLES (COLOR ENABLED) --- */
        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { display: block; position: absolute; left: 0; top: 0; width: 100%; padding: 1.5rem; box-sizing: border-box; }
            .print-avoid-break { page-break-inside: avoid; }
            @page { size: A4; margin: 0; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }

        /* --- TEMPLATE-SPECIFIC STYLES --- */
        .cv-template { font-size: 0.65rem; line-height: 1.6; }
        .cv-template h1 { font-size: 2.2rem; font-weight: 700; }
        .cv-template h2 {
            font-weight: 700; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.05em;
            color: var(--accent-color); border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.25rem; margin-bottom: 0.75rem;
        }
        .cv-template h3 { font-weight: 600; font-size: 0.75rem; }
        .cv-template p, .cv-template li { color: #374151; }
        .cv-template ul { list-style-type: disc; padding-left: 1rem; }

        /* Existing Templates */
        .template-classic { padding: 2rem; }
        .template-classic .header { text-align: center; margin-bottom: 1rem; }
        .template-classic .contact-bar { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; padding: 0.5rem 0; font-size: 0.6rem; border-top: 1px solid #e5e7eb; border-bottom: 1px solid #e5e7eb; margin-bottom: 1.5rem;}
        .template-classic .main-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; }
        .template-classic .level { background-color: #e5e7eb; height: 5px; }
        .template-classic .level-fill { background-color: var(--accent-color); height: 5px; }
        .template-executive .header { text-align: center; padding: 1.5rem 2rem; border-bottom: 4px solid var(--accent-color); }
        .template-executive .contact-bar { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; padding: 0.5rem; font-size: 0.6rem; background-color: #f8fafc; }
        .template-executive .main-content { padding: 1.5rem 2rem; }
        .template-creative .header { display: flex; align-items: center; padding: 1.5rem; gap: 1.5rem; background-color: var(--accent-color); color: white; }
        .template-creative #cv-photo { width: 90px; height: 90px; border: 3px solid white; }
        .template-creative .header h1 { font-size: 2rem; color: white; }
        .template-creative .main-grid { display: grid; grid-template-columns: 1.2fr 2.5fr; gap: 1.5rem; padding: 1.5rem; }
        .template-creative h2 { color: #1f2937; }
        .template-creative .skill-dots span { width: 8px; height: 8px; border-radius: 50%; background-color: #e5e7eb; }
        .template-creative .skill-dots span.filled { background-color: var(--accent-color); }
        .template-sidebar { display: flex; }
        .template-sidebar .sidebar { width: 35%; background-color: #f8fafc; padding: 1.5rem; }
        .template-sidebar .sidebar h1 { font-size: 1.8rem; line-height: 1.2; }
        .template-sidebar .sidebar #cv-job-title { font-size: 0.8rem; }
        .template-sidebar .main-content { width: 65%; padding: 1.5rem; }
        .template-sidebar .level { background-color: #e5e7eb; height: 5px; }
        .template-sidebar .level-fill { background-color: var(--accent-color); height: 5px; }

        /* New Templates */
        .template-minimalist { padding: 2.5rem; }
        .template-minimalist .header { text-align: center; margin-bottom: 2rem; }
        .template-minimalist .contact-bar { display: flex; flex-wrap: wrap; justify-content: center; gap: 0.5rem 1.5rem; font-size: 0.6rem; margin-top: 0.5rem; color: #6b7280; }
        .template-minimalist h2 { border-bottom: 1px solid #e5e7eb; color: #111827; }
        .template-technical { padding: 2rem; font-family: 'Roboto Mono', monospace;}
        .template-technical h1, .template-technical h2 { font-family: 'Roboto Mono', monospace; }
        .template-technical .header { display: flex; justify-content: space-between; align-items: baseline; border-bottom: 2px solid var(--accent-color); padding-bottom: 0.5rem; }
        .template-technical .contact-list { text-align: right; font-size: 0.6rem; }
        .template-academic { padding: 2rem; font-family: 'Lora', serif; }
        .template-academic .header { text-align: center; margin-bottom: 1.5rem; }
        .template-academic h1, .template-academic h2 { font-family: 'Lora', serif; }
        .template-bold { padding: 2rem; }
        .template-bold h1, .template-bold h2, .template-bold h3 { font-weight: 800; }
        .template-bold h2 { border-bottom-width: 3px; }
        .template-timeline { padding: 2rem; }
        .template-timeline .timeline-container { position: relative; padding-left: 2rem; }
        .template-timeline .timeline-container::before { content: ''; position: absolute; left: 0.5rem; top: 0; bottom: 0; width: 2px; background-color: #e5e7eb;}
        .template-timeline .timeline-item { position: relative; margin-bottom: 1rem; }
        .template-timeline .timeline-item::before { content: ''; position: absolute; left: -2rem; top: 0.25rem; width: 1rem; height: 1rem; background-color: var(--accent-color); border-radius: 50%; border: 2px solid white; }
        .template-corporate { padding: 0; }
        .template-corporate .header { padding: 1.5rem 2rem; background-color: #f8fafc; border-bottom: 2px solid var(--accent-color); }
        .template-corporate .main-grid { display: grid; grid-template-columns: 2.5fr 1fr; gap: 2rem; padding: 1.5rem 2rem;}

        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen">
    
    <header class="lg:hidden sticky top-0 z-30 bg-white shadow-md p-4 flex justify-between items-center">
        <button id="menu-toggle" class="p-2 -ml-2" aria-label="Open navigation menu">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </button>
        <h1 class="text-lg font-bold accent-text">CV Architect</h1>
        <button id="view-toggle" class="p-2 -mr-2 flex items-center gap-1 text-sm font-semibold accent-text" aria-label="Switch to preview view">
            <span id="view-toggle-text">Preview</span>
            <svg id="view-toggle-icon-eye" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
            <svg id="view-toggle-icon-pencil" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
        </button>
    </header>

    <div id="mobile-overlay" class="lg:hidden"></div>

    <div class="lg:grid lg:grid-cols-12" style="height: calc(100vh - 64px);">
        <aside id="sidebar" class="fixed top-0 left-0 z-50 h-full w-64 bg-white p-6 flex flex-col justify-between shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out lg:relative lg:translate-x-0 lg:col-span-2 lg:shadow-none">
            <div>
                <h1 class="text-2xl font-bold accent-text mb-8 hidden lg:block">CV Architect Pro</h1>
                <nav id="sidebar-nav" class="space-y-2"></nav>
            </div>
            <div>
                <div class="space-y-2 text-sm font-semibold border-t pt-4 mt-4">
                    <button id="import-data" class="w-full text-left text-gray-600 hover:text-black">Import Data (JSON)</button>
                    <button id="export-data" class="w-full text-left text-gray-600 hover:text-black">Export Data (JSON)</button>
                </div>
                <div id="save-indicator" class="text-sm font-semibold text-green-600 my-2" style="opacity: 0;">Saved!</div>
                <div class="text-xs text-gray-400 border-t pt-4 mt-2">
                    <p class="font-semibold text-gray-500">Created by Akhtar Nazeer</p>
                    <p>0319-5410126</p>
                    <p>akhtarnazeer2004@gmail.com</p>
                    <button id="clear-data" class="w-full text-left mt-2 text-red-500 hover:text-red-700 font-semibold" aria-label="Clear all resume data">Clear All Data</button>
                </div>
            </div>
        </aside>

        <main id="form-container" class="lg:col-span-5 p-4 sm:p-8 overflow-y-auto">
            <div id="form-wizard"></div>
        </main>

        <aside id="preview-container" class="hidden lg:block lg:col-span-5 bg-gray-200 p-4 sm:p-8 overflow-y-auto">
            <div class="sticky top-8">
                <h2 class="text-xl font-bold text-gray-700 mb-4">Live Preview</h2>
                <div class="a4-preview-wrapper">
                    <div id="cv-preview" class="bg-white a4-preview overflow-y-auto cv-template"></div>
                </div>
                <button id="print-cv" class="mt-6 w-full accent-bg text-white py-2.5 px-4 rounded-md hover:opacity-90 font-bold transition flex items-center justify-center gap-2" aria-label="Print or save resume as PDF">
                    <span id="print-text">Print / Save as PDF</span>
                    <span id="print-loader" class="hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
                </button>
            </div>
        </aside>
    </div>
    
    <div id="print-area" class="cv-template"></div>
    
    <svg width="0" height="0" style="display:none;">
        <symbol id="icon-email" viewBox="0 0 20 20" fill="currentColor"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></symbol>
        <symbol id="icon-phone" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path></symbol>
        <symbol id="icon-location" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></symbol>
        <symbol id="icon-linkedin" viewBox="0 0 24 24" fill="currentColor"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></symbol>
        <symbol id="icon-grab" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm0 6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm0 6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2z"/></symbol>
    </svg>

<script type="module">
// --- CV ARCHITECT PRO - FINAL, REFACTORED VERSION ---

// --- UTILITIES & STATE ---
const $ = (selector) => document.querySelector(selector);
const $$ = (selector) => document.querySelectorAll(selector);
let cvData = {};
const defaultData = {
    template: 'classic',
    accentColor: '#4f46e5',
    fullName: 'Akhtar Nazeer',
    jobTitle: 'Aspiring Software Developer',
    objective: 'Detail-oriented and motivated university student pursuing a degree in Computer Science. Eager to leverage academic knowledge of software development, algorithms, and data structures in a challenging internship role. Passionate about learning new technologies and contributing to impactful projects.',
    email: 'akhtarnazeer2004@gmail.com',
    phone: '0319-5410126',
    address: 'Mansehra, Pakistan',
    linkedin: 'linkedin.com/in/akhtar-nazeer',
    photo: 'https://placehold.co/150x150/E2E8F0/A0AEC0?text=AN',
    skills: [ { id: 1, name: 'JavaScript & HTML/CSS', level: 4 }, { id: 2, name: 'React.js', level: 3 }, { id: 3, name: 'Node.js & Express', level: 3 }, { id: 4, name: 'SQL & Databases', level: 3 }, ],
    experience: [ { id: 1, jobTitle: 'Web Dev Project (Academic)', company: 'Hazara University', location: 'Mansehra', startDate: 'Spring 2025', endDate: 'Present', description: 'Developed a full-stack web application for course registration using the MERN stack.\nDesigned and implemented a RESTful API for handling student and course data.\nCollaborated with a team of 3 students, using Git for version control.' }, ],
    education: [ { id: 1, degree: 'BS in Computer Science', institution: 'Hazara University, Mansehra', startDate: '2021', endDate: '2025', description: 'Relevant Coursework: Data Structures, Algorithms, Web Development, Database Systems.' }, ],
    certificates: [ { id: 1, name: 'Responsive Web Design', issuer: 'freeCodeCamp', date: '2024' } ],
    languages: [ { id: 1, name: 'Urdu', level: 'Native' }, { id: 2, name: 'English', level: 'Professional' }, { id: 3, name: 'Pashto', level: 'Native' }, ],
    projects: [ { id: 1, name: 'Personal Portfolio Website', tech: 'HTML, CSS, JavaScript', link: 'github.com/your-repo', description: 'A responsive personal portfolio to showcase my skills and projects.'}],
    interests: 'Open-source contribution, competitive programming, hiking.',
};
const formStepsConfig = [ { id: 'settings', title: 'Settings', icon: '⚙️' }, { id: 'personal', title: 'Personal Info', icon: '👤' }, { id: 'contact', title: 'Contact', icon: '📞' }, { id: 'objective', title: 'Objective', icon: '🎯' }, { id: 'experience', title: 'Experience', icon: '💼' }, { id: 'projects', title: 'Projects', icon: '🚀' }, { id: 'education', title: 'Education', icon: '🎓' }, { id: 'skills', title: 'Skills', icon: '🛠️' }, { id: 'languages', title: 'Languages', icon: '🌐' }, { id: 'certificates', title: 'Certificates', icon: '📜' }, { id: 'interests', title: 'Interests', icon: '⭐' }, { id: 'photo', title: 'Photo', icon: '📷' }, ];
let activeStep = 'settings';

// --- SECURITY UTILITY ---
const sanitizeHTML = (str) => {
    if (!str) return '';
    const temp = document.createElement('div');
    temp.textContent = str;
    return temp.innerHTML;
};

// --- INITIALIZATION & DATA HANDLING ---
function init() {
    loadData();
    buildSidebar();
    buildForm();
    addEventListeners();
    navigateTo(activeStep);
    scalePreview(); // Initial scaling
}

function loadData() {
    try {
        const savedData = localStorage.getItem('cvArchitectData');
        cvData = savedData ? JSON.parse(savedData) : JSON.parse(JSON.stringify(defaultData));
    } catch (error) {
        console.error("Failed to load or parse data from localStorage:", error);
        cvData = JSON.parse(JSON.stringify(defaultData));
    }
    document.documentElement.style.setProperty('--accent-color', cvData.accentColor);
}

function saveData() {
    try {
        localStorage.setItem('cvArchitectData', JSON.stringify(cvData));
        const saveIndicator = $('#save-indicator');
        saveIndicator.style.opacity = '1';
        setTimeout(() => { saveIndicator.style.opacity = '0'; }, 1500);
    } catch (error) {
        console.error("Failed to save data to localStorage:", error);
    }
    renderCV();
}

function clearData() {
    if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
        localStorage.removeItem('cvArchitectData');
        window.location.reload();
    }
}

// --- DATA IMPORT/EXPORT ---
function exportData() {
    const jsonString = JSON.stringify(cvData, null, 2);
    const blob = new Blob([jsonString], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `cv-architect-data-${Date.now()}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function importData() {
    if (!confirm('Importing data will overwrite your current CV. Are you sure you want to continue?')) {
        return;
    }
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'application/json';
    input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = readerEvent => {
            try {
                const newCvData = JSON.parse(readerEvent.target.result);
                // Basic validation
                if (newCvData.fullName && newCvData.template) {
                    cvData = newCvData;
                    saveData();
                    // Full reload to ensure all states are fresh
                    window.location.reload(); 
                } else {
                    alert('Invalid JSON file. Make sure it was exported from CV Architect Pro.');
                }
            } catch (err) {
                alert('Error reading or parsing the file.');
                console.error(err);
            }
        };
        reader.readAsText(file, 'UTF-8');
    };
    input.click();
}

// --- UI BUILDING ---
function buildSidebar() {
    $('#sidebar-nav').innerHTML = formStepsConfig.map(step => `<a href="#" class="step-link flex items-center gap-3 px-4 py-2 rounded-md font-semibold text-gray-600 hover:bg-gray-100" data-step="${step.id}" aria-label="Navigate to ${step.title} section"><span>${step.icon}</span> <span>${step.title}</span></a>`).join('');
}

function buildForm() {
    $('#form-wizard').innerHTML = formStepsConfig.map(step => `<div id="step-${step.id}" class="form-step hidden" role="tabpanel" aria-labelledby="step-link-${step.id}"><h2 class="text-3xl font-bold mb-6">${step.title}</h2>${getFormFieldsForStep(step.id)}</div>`).join('');
}

function getFormFieldsForStep(stepId) {
    const s = (value) => sanitizeHTML(value);
    const simpleInput = (id, label, value) => `<div><label for="${id}" class="block font-medium mb-1">${label}</label><input type="text" id="${id}" value="${s(value)}" class="w-full p-2 border rounded-md accent-ring"></div>`;
    const themeOptions = ['Classic', 'Sidebar', 'Executive', 'Creative', 'Minimalist', 'Technical', 'Academic', 'Bold', 'Timeline', 'Corporate'];

    const themePreviews = `<div class="theme-preview-grid mt-4">${themeOptions.map(t => `
        <div class="theme-preview" data-theme="${t.toLowerCase()}" title="Select ${t} theme">
            <div class="title">${t}</div>
            <div class="space-y-1.5"><div class="bar"><div class="accent-bar"></div></div><div class="bar"></div><div class="bar"></div></div>
        </div>`).join('')}</div>`;
    
    switch(stepId) {
        case 'settings': return `<div><label for="template" class="block font-medium mb-2">Template</label><select id="template" class="w-full p-2 border rounded-md accent-ring">${themeOptions.map(t => `<option value="${t.toLowerCase()}" ${cvData.template === t.toLowerCase() ? 'selected' : ''}>${t}</option>`).join('')}</select>${themePreviews}</div><div class="mt-6"><label for="accentColor" class="block font-medium mb-2">Accent Color</label><input type="color" id="accentColor" value="${s(cvData.accentColor)}" class="w-full h-10 p-1 border rounded-md"></div>`;
        case 'personal': return `${simpleInput('fullName', 'Full Name', cvData.fullName)}<div class="mt-4">${simpleInput('jobTitle', 'Job Title', cvData.jobTitle)}</div>`;
        case 'contact': return `${simpleInput('email', 'Email', cvData.email)}<div class="mt-4">${simpleInput('phone', 'Phone', cvData.phone)}</div><div class="mt-4">${simpleInput('address', 'Address', cvData.address)}</div><div class="mt-4">${simpleInput('linkedin', 'LinkedIn', cvData.linkedin)}</div>`;
        case 'objective': return `<div><label for="objective" class="block font-medium mb-1">Objective Statement</label><p class="text-sm text-gray-500 mb-2">A 2-3 sentence summary of your goals and skills.</p><textarea id="objective" rows="5" class="w-full p-2 border rounded-md accent-ring">${s(cvData.objective)}</textarea></div>`;
        case 'interests': return `<div><label for="interests" class="block font-medium mb-1">Interests / Hobbies</label><p class="text-sm text-gray-500 mb-2">List a few of your interests, separated by commas.</p><textarea id="interests" rows="4" class="w-full p-2 border rounded-md accent-ring">${s(cvData.interests)}</textarea></div>`;
        case 'photo': return `<p class="text-sm text-gray-600 mb-4">Used for 'Creative' and 'Sidebar' templates.</p><input type="file" id="photo-upload" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/><div id="crop-container" class="mt-4 hidden p-4 border-2 border-dashed rounded-lg text-center"><p class="font-semibold mb-2">Adjust your photo</p><div class="mx-auto w-48 h-48 rounded-full overflow-hidden"><canvas id="crop-canvas" width="192" height="192"></canvas></div><button id="crop-button" class="mt-4 w-full accent-bg text-white py-2 px-4 rounded-md hover:opacity-90">Confirm Crop</button></div>`;
        default: return `<div id="${stepId}-list"></div><button class="add-entry mt-4 font-semibold accent-text" data-type="${stepId}">+ Add ${stepId.charAt(0).toUpperCase() + stepId.slice(1)}</button>`;
    }
}

function buildList(type, data) {
    const container = $(`#${type}-list`);
    if (!container) return;
    container.innerHTML = data && data.length > 0
        ? data.map(item => getListItemHTML(type, item)).join('')
        : `<p class="text-sm text-gray-400" id="${type}-placeholder">No entries yet. Click the button below to add one.</p>`;
    if (data && data.length > 0) addDragDropListeners(container);
}

function getListItemHTML(type, item) {
    const s = (value) => sanitizeHTML(value);
    const fields = {
        experience: `<input type="text" data-key="jobTitle" value="${s(item.jobTitle)}" placeholder="Job Title" class="font-semibold w-full p-1"><input type="text" data-key="company" value="${s(item.company)}" placeholder="Company" class="w-full p-1"><div class="flex gap-2"><input type="text" data-key="startDate" value="${s(item.startDate)}" placeholder="Start Date" class="w-1/2 p-1"><input type="text" data-key="endDate" value="${s(item.endDate)}" placeholder="End Date" class="w-1/2 p-1"></div><p class="text-xs text-gray-500 px-1">Tip: Write each point on a new line for automatic bullets.</p><textarea data-key="description" rows="4" placeholder="Description..." class="w-full p-1 text-sm">${s(item.description)}</textarea>`,
        projects: `<input type="text" data-key="name" value="${s(item.name)}" placeholder="Project Name" class="font-semibold w-full p-1"><input type="text" data-key="tech" value="${s(item.tech)}" placeholder="Tech Stack (e.g., React, Node.js)" class="w-full p-1"><input type="text" data-key="link" value="${s(item.link)}" placeholder="Project or Repo Link" class="w-full p-1"><textarea data-key="description" rows="3" placeholder="Description..." class="w-full p-1 text-sm">${s(item.description)}</textarea>`,
        education: `<input type="text" data-key="degree" value="${s(item.degree)}" placeholder="Degree" class="font-semibold w-full p-1"><input type="text" data-key="institution" value="${s(item.institution)}" placeholder="Institution" class="w-full p-1"><div class="flex gap-2"><input type="text" data-key="startDate" value="${s(item.startDate)}" placeholder="Start Year" class="w-1/2 p-1"><input type="text" data-key="endDate" value="${s(item.endDate)}" placeholder="End Year" class="w-1/2 p-1"></div><input type="text" data-key="description" value="${s(item.description)}" placeholder="Optional: GPA, Honors..." class="w-full p-1 text-sm">`,
        skills: `<div class="flex items-center gap-2"><input type="text" data-key="name" value="${s(item.name)}" placeholder="Skill Name" class="w-full p-1"><input type="range" data-key="level" value="${s(item.level)}" min="1" max="5" class="w-32 accent-bg"><span class="skill-level-indicator font-semibold text-gray-600 w-4 text-center">${s(item.level)}</span></div>`,
        languages: `<div class="flex items-center gap-2"><input type="text" data-key="name" value="${s(item.name)}" placeholder="Language" class="w-1/2 p-1"><input type="text" data-key="level" value="${s(item.level)}" placeholder="e.g., Native, Fluent" class="w-1/2 p-1"></div>`,
        certificates: `<input type="text" data-key="name" value="${s(item.name)}" placeholder="Certificate Name" class="w-full p-1"><input type="text" data-key="issuer" value="${s(item.issuer)}" placeholder="Issuer" class="w-full p-1"><input type="text" data-key="date" value="${s(item.date)}" placeholder="Date" class="w-full p-1">`,
    };
    return `<div class="list-item p-4 border rounded-lg mb-4 bg-white shadow-sm" draggable="true" data-id="${item.id}" data-type="${type}">
                <div class="list-item-header">
                    <div class="flex-grow space-y-2">${fields[type]}</div>
                    <div class="pl-2 drag-handle" title="Drag to reorder"><svg class="w-6 h-6"><use xlink:href="#icon-grab"></use></svg></div>
                </div>
                <button class="remove-entry mt-2 text-xs text-red-500 hover:text-red-700" aria-label="Remove this ${type} entry">Remove</button>
            </div>`;
}

// --- EVENT LISTENERS ---
function addEventListeners() {
    const sidebar = $('#sidebar');
    const mobileOverlay = $('#mobile-overlay');

    $('#menu-toggle').addEventListener('click', () => {
        sidebar.classList.toggle('-translate-x-full');
        mobileOverlay.classList.toggle('active');
    });

    mobileOverlay.addEventListener('click', () => {
        sidebar.classList.add('-translate-x-full');
        mobileOverlay.classList.remove('active');
    });

    $('#view-toggle').addEventListener('click', () => {
        $('#form-container').classList.toggle('hidden');
        $('#preview-container').classList.toggle('hidden');
        $('#preview-container').classList.toggle('lg:block');

        const text = $('#view-toggle-text'), eyeIcon = $('#view-toggle-icon-eye'), pencilIcon = $('#view-toggle-icon-pencil');
        if ($('#preview-container').classList.contains('hidden')) {
            text.textContent = 'Preview'; eyeIcon.classList.remove('hidden'); pencilIcon.classList.add('hidden');
        } else {
            text.textContent = 'Editor'; eyeIcon.classList.add('hidden'); pencilIcon.classList.remove('hidden');
        }
    });

    $('#sidebar-nav').addEventListener('click', e => {
        const link = e.target.closest('.step-link');
        if (link) { 
            e.preventDefault(); 
            navigateTo(link.dataset.step);
            if (window.innerWidth < 1024) {
                sidebar.classList.add('-translate-x-full');
                mobileOverlay.classList.remove('active');
                $('#form-container').classList.remove('hidden');
                $('#preview-container').classList.add('hidden');
                $('#preview-container').classList.add('lg:block');
                $('#view-toggle-text').textContent = 'Preview';
                $('#view-toggle-icon-eye').classList.remove('hidden');
                $('#view-toggle-icon-pencil').classList.add('hidden');
            }
        }
    });

    let debounceTimer;
    $('#form-wizard').addEventListener('input', e => {
        const target = e.target;
        if (target.closest('.list-item')) {
            const itemEl = target.closest('.list-item');
            const { id, type } = itemEl.dataset;
            const key = target.dataset.key;
            const item = cvData[type]?.find(i => i.id == id);
            if (item) item[key] = target.value;

            if (key === 'level') {
                const indicator = itemEl.querySelector('.skill-level-indicator');
                if (indicator) indicator.textContent = target.value;
            }
        } else if (target.id) {
            if (target.id === 'accentColor') document.documentElement.style.setProperty('--accent-color', target.value);
            if (cvData.hasOwnProperty(target.id)) cvData[target.id] = target.value;
        }
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(saveData, 300);
    });
    
    $('#form-wizard').addEventListener('click', e => {
        const target = e.target;
        if (target.matches('.add-entry')) {
            const type = target.dataset.type;
            const newItemTemplates = {
                certificates: { id: Date.now(), name: '', issuer: '', date: '' },
                skills: { id: Date.now(), name: '', level: 3 },
                languages: { id: Date.now(), name: '', level: '' },
                experience: { id: Date.now(), jobTitle: '', company: '', startDate: '', endDate: '', description: '' },
                education: { id: Date.now(), degree: '', institution: '', startDate: '', endDate: '', description: '' },
                projects: { id: Date.now(), name: '', tech: '', link: '', description: ''},
            };
            const newItem = newItemTemplates[type];
            if (!newItem) return;

            if (!cvData[type]) cvData[type] = [];
            cvData[type].push(newItem);
            
            const listContainer = $(`#${type}-list`);
            const placeholder = $(`#${type}-placeholder`);
            if(placeholder) placeholder.remove();
            listContainer.insertAdjacentHTML('beforeend', getListItemHTML(type, newItem));
            addDragDropListeners(listContainer);
            saveData();
        }
        if (target.matches('.remove-entry')) {
            const itemEl = target.closest('.list-item');
            const { id, type } = itemEl.dataset;
            cvData[type] = cvData[type].filter(i => i.id != id);
            itemEl.remove();
            if (cvData[type].length === 0) {
                $(`#${type}-list`).innerHTML = `<p class="text-sm text-gray-400" id="${type}-placeholder">No entries yet. Click the button below to add one.</p>`;
            }
            saveData();
        }
        if (target.closest('.theme-preview')) {
            const theme = target.closest('.theme-preview').dataset.theme;
            $('#template').value = theme;
            cvData.template = theme;
            updateActiveThemePreview();
            saveData();
        }
    });

    $('#print-cv').addEventListener('click', prepareAndPrint);
    $('#clear-data').addEventListener('click', clearData);
    $('#import-data').addEventListener('click', importData);
    $('#export-data').addEventListener('click', exportData);
    setupPhotoCropper(); // Attach photo listeners once on init
    window.addEventListener('resize', scalePreview); // Rescale on window resize
}

// --- DRAG & DROP FUNCTIONALITY ---
function addDragDropListeners(container) {
    let draggedItem = null;
    container.addEventListener('dragstart', e => {
        if (e.target.classList.contains('list-item')) {
            draggedItem = e.target;
            setTimeout(() => e.target.classList.add('dragging'), 0);
        }
    });
    container.addEventListener('dragend', () => {
        if (draggedItem) {
            draggedItem.classList.remove('dragging');
            draggedItem = null;
        }
    });
    container.addEventListener('dragover', e => {
        e.preventDefault();
        const afterElement = getDragAfterElement(container, e.clientY);
        const currentDragged = $('.dragging');
        if (currentDragged) {
             if (afterElement == null) {
                container.appendChild(currentDragged);
            } else {
                container.insertBefore(currentDragged, afterElement);
            }
        }
    });
    container.addEventListener('drop', e => {
        e.preventDefault();
        if (draggedItem) {
            const type = draggedItem.dataset.type;
            const reorderedIds = [...container.querySelectorAll('.list-item')].map(item => parseInt(item.dataset.id));
            cvData[type].sort((a, b) => reorderedIds.indexOf(a.id) - reorderedIds.indexOf(b.id));
            saveData();
        }
    });
}

function getDragAfterElement(container, y) {
    const draggableElements = [...container.querySelectorAll('.list-item:not(.dragging)')];
    return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) {
            return { offset: offset, element: child };
        } else {
            return closest;
        }
    }, { offset: Number.NEGATIVE_INFINITY }).element;
}

// --- RESPONSIVE PREVIEW SCALING ---
function scalePreview() {
    const preview = $('#cv-preview');
    const wrapper = $('.a4-preview-wrapper');
    if (!preview || !wrapper) return;

    const scale = wrapper.offsetWidth / preview.offsetWidth;
    preview.style.transform = `scale(${scale})`;
    wrapper.style.height = `${preview.offsetHeight * scale}px`;
}

function setupPhotoCropper() {
    const photoUpload = $('#photo-upload');
    const cropContainer = $('#crop-container');
    const canvas = $('#crop-canvas');
    if (!photoUpload) return;
    
    const cropImage = new Image();
    cropImage.crossOrigin = "Anonymous";

    photoUpload.addEventListener('change', e => {
        const file = e.target.files[0];
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = event => { cropImage.src = event.target.result; };
            reader.readAsDataURL(file);
        } else if (file) {
            alert("Please select a valid image file.");
        }
    });

    cropImage.onload = () => {
        cropContainer.classList.remove('hidden');
        const ctx = canvas.getContext('2d');
        const size = 192;
        let scale = Math.max(size / cropImage.width, size / cropImage.height), x = (size - cropImage.width * scale) / 2, y = (size - cropImage.height * scale) / 2;
        let isDragging = false, startX, startY;

        const draw = () => {
            ctx.clearRect(0, 0, size, size); 
            ctx.drawImage(cropImage, x, y, cropImage.width * scale, cropImage.height * scale); 
        };
        draw();
        
        canvas.style.cursor = 'grab';
        canvas.onmousedown = (e) => { isDragging = true; startX = e.clientX - x; startY = e.clientY - y; canvas.style.cursor = 'grabbing'; };
        canvas.onmousemove = (e) => { if(isDragging) { x = e.clientX - startX; y = e.clientY - startY; draw(); }};
        const stopDragging = () => { isDragging = false; canvas.style.cursor = 'grab'; };
        canvas.onmouseup = stopDragging; 
        canvas.onmouseleave = stopDragging;
    };
    cropImage.onerror = () => alert("Failed to load image. Please try another file.");

    $('#crop-button').addEventListener('click', () => { 
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');
        tempCanvas.width = 192;
        tempCanvas.height = 192;
        tempCtx.beginPath();
        tempCtx.arc(96, 96, 96, 0, Math.PI * 2, true);
        tempCtx.clip();
        tempCtx.drawImage(canvas, 0, 0);
        cvData.photo = tempCanvas.toDataURL('image/jpeg'); 
        cropContainer.classList.add('hidden'); 
        saveData(); 
    });
}

function updateActiveThemePreview() {
    $$('.theme-preview').forEach(el => el.classList.remove('active'));
    const activePreview = $(`.theme-preview[data-theme="${cvData.template}"]`);
    if(activePreview) activePreview.classList.add('active');
}

function navigateTo(stepId) {
    activeStep = stepId;
    $$('.form-step').forEach(s => s.classList.add('hidden'));
    const stepEl = $(`#step-${stepId}`);
    stepEl.classList.remove('hidden');
    stepEl.classList.add('fade-in');
    $$('.step-link').forEach(l => l.classList.remove('active'));
    $(`.step-link[data-step="${stepId}"]`).classList.add('active');
    if (['experience', 'education', 'skills', 'languages', 'certificates', 'projects'].includes(stepId)) { buildList(stepId, cvData[stepId]); }
    if (stepId === 'settings') { updateActiveThemePreview(); }
}

// --- PRINTING ENGINE ---
function prepareAndPrint() {
    const printLoader = $('#print-loader'), printText = $('#print-text');
    printText.classList.add('hidden'); printLoader.classList.remove('hidden');
    const printArea = $('#print-area');
    printArea.innerHTML = getTemplateHTML(true);
    setTimeout(() => { 
        try { window.print(); } catch (e) { console.error("Printing failed:", e); }
        printText.classList.remove('hidden'); printLoader.classList.add('hidden'); 
    }, 250);
}

// --- CV RENDERING ENGINE ---
function renderCV() {
    const preview = $('#cv-preview');
    preview.className = `bg-white a4-preview cv-template template-${cvData.template}`;
    preview.innerHTML = getTemplateHTML();
    scalePreview(); // Rescale after render
}

function getTemplateHTML(forPrint = false) {
    const renderers = { executive: renderExecutiveCV, creative: renderCreativeCV, classic: renderClassicCV, sidebar: renderSidebarCV, minimalist: renderMinimalistCV, technical: renderTechnicalCV, academic: renderAcademicCV, bold: renderBoldCV, timeline: renderTimelineCV, corporate: renderCorporateCV };
    const html = renderers[cvData.template] ? renderers[cvData.template]() : `<div>Template not found.</div>`;
    if (forPrint) {
        const printVersion = document.createElement('div');
        printVersion.className = `cv-template template-${cvData.template}`;
        printVersion.innerHTML = html;
        return printVersion.outerHTML;
    }
    return html;
}

// --- TEMPLATE RENDERER HELPERS ---
const s = (value) => sanitizeHTML(String(value || ''));
const renderIcon = (iconId) => `<svg class="w-4 h-4 inline-block mr-2 shrink-0"><use xlink:href="#icon-${iconId}"></use></svg>`;
const contactItem = (icon, text) => text ? `<div class="flex items-center text-gray-600 print-avoid-break">${renderIcon(icon)}<span>${s(text)}</span></div>` : '';
const certSection = (data) => (data && data.length > 0) ? `<section class="pt-4 print-avoid-break"><h2>Certificates</h2>${data.map(c => `<div class="mb-2 print-avoid-break"><h3>${s(c.name)}</h3><p class="text-xs text-gray-600">${s(c.issuer)} (${s(c.date)})</p></div>`).join('')}</section>` : '';
const interestsSection = (data) => (data && data.trim() !== '') ? `<section class="pt-4 print-avoid-break"><h2>Interests</h2><p class="text-sm">${s(data)}</p></section>` : '';
const projectsSection = (data) => (data && data.length > 0) ? `<section class="pt-4 print-avoid-break"><h2>Projects</h2>${data.map(p => `<div class="mb-4 print-avoid-break"><h3>${s(p.name)}</h3><p class="text-sm font-semibold accent-text">${s(p.tech)}</p>${p.link ? `<a href="${s(p.link)}" target="_blank" class="text-xs text-gray-500">${s(p.link)}</a>` : ''}<div class="text-sm mt-1 text-gray-700">${formatDescription(p.description)}</div></div>`).join('')}</section>` : '';
const formatDescription = (text) => {
    if (!text || typeof text !== 'string') return '';
    const sanitizedText = s(text);
    const lines = sanitizedText.split('\n').map(line => line.trim()).filter(line => line.length > 0);
    if (lines.length > 0) {
        return `<ul>${lines.map(line => `<li>${line}</li>`).join('')}</ul>`;
    }
    return '';
};

// Helper to fix contact bar separator issue
const buildContactBar = (items, separator) => {
    return items.filter(item => item && item.trim() !== '').map(item => `<span>${s(item)}</span>`).join(`<span class="mx-2">${separator}</span>`);
};

// --- REFACTORED TEMPLATE RENDERERS ---
function renderClassicCV() {
    const skillBar = (skill) => `<div class="skill-item print-avoid-break"><span class="text-sm font-semibold">${s(skill.name)}</span><div class="level w-full rounded-full mt-1"><div class="level-fill rounded-full" style="width: ${s(skill.level) * 20}%"></div></div></div>`;
    const contactInfo = buildContactBar([cvData.email, cvData.phone, cvData.address, cvData.linkedin], '|');
    return `<header class="header"><h1>${s(cvData.fullName)}</h1><p class="font-semibold accent-text">${s(cvData.jobTitle)}</p></header>
        <div class="contact-bar">${contactInfo}</div>
        <main class="main-grid">
            <div class="left-col">
                <section class="print-avoid-break"><h2>Objective</h2><p>${s(cvData.objective)}</p></section>
                <section class="pt-4 print-avoid-break"><h2>Education</h2>${cvData.education.map(e=>`<div class="mb-3 print-avoid-break"><h3>${s(e.degree)}</h3><p class="text-sm">${s(e.institution)} | ${s(e.startDate)} - ${s(e.endDate)}</p><p class="text-xs text-gray-600">${s(e.description)}</p></div>`).join('')}</section>
                <section class="pt-4 print-avoid-break"><h2>Experience</h2>${cvData.experience.map(e=>`<div class="mb-4 print-avoid-break"><h3>${s(e.jobTitle)}</h3><p class="text-sm font-semibold accent-text">${s(e.company)} | ${s(e.startDate)} - ${s(e.endDate)}</p><div class="text-sm mt-1 text-gray-700">${formatDescription(e.description)}</div></div>`).join('')}</section>
                ${projectsSection(cvData.projects)}
            </div>
            <div class="right-col">
                <section class="print-avoid-break"><h2>Skills</h2><div class="space-y-3">${cvData.skills.map(skillBar).join('')}</div></section>
                ${certSection(cvData.certificates)}
                <section class="pt-4 print-avoid-break"><h2>Languages</h2>${cvData.languages.map(l=>`<p class="print-avoid-break">${s(l.name)} <span class="text-gray-500">- ${s(l.level)}</span></p>`).join('')}</section>
                ${interestsSection(cvData.interests)}
            </div>
        </main>`;
}
function renderExecutiveCV() { const contactInfo = buildContactBar([cvData.email, cvData.phone, cvData.address, cvData.linkedin], '|'); return `<header class="header"><h1>${s(cvData.fullName)}</h1><p>${s(cvData.jobTitle)}</p></header><div class="contact-bar">${contactInfo}</div><main class="main-content"><section class="print-avoid-break"><h2>Objective</h2><p>${s(cvData.objective)}</p></section><section class="pt-4 print-avoid-break"><h2>Education</h2>${cvData.education.map(e=>`<div class="mb-3 print-avoid-break"><h3>${s(e.degree)}</h3><p class="text-sm">${s(e.institution)} | ${s(e.startDate)} - ${s(e.endDate)}</p><p class="text-xs text-gray-600">${s(e.description)}</p></div>`).join('')}</section><section class="pt-4 print-avoid-break"><h2>Experience</h2>${cvData.experience.map(e=>`<div class="mb-4 print-avoid-break"><h3>${s(e.jobTitle)}</h3><p class="text-sm font-semibold accent-text">${s(e.company)} | ${s(e.startDate)} - ${s(e.endDate)}</p><div class="text-sm mt-1 text-gray-700">${formatDescription(e.description)}</div></div>`).join('')}</section>${projectsSection(cvData.projects)}<div class="grid grid-cols-2 gap-6 pt-4"><section class="print-avoid-break"><h2>Skills</h2><div class="space-y-1">${cvData.skills.map(skill=>`<p class="text-sm">${s(skill.name)}</p>`).join('')}</div></section><section class="print-avoid-break"><h2>Languages</h2>${cvData.languages.map(l=>`<p class="text-sm">${s(l.name)} <span class="text-gray-500">- ${s(l.level)}</span></p>`).join('')}</section></div>${certSection(cvData.certificates)}${interestsSection(cvData.interests)}</main>`; }
function renderCreativeCV() { const skillDots=(skill)=>`<div class="skill-item flex justify-between items-center print-avoid-break"><span>${s(skill.name)}</span><div class="skill-dots flex gap-1">${[...Array(5)].map((_,i)=>`<span class="${i<skill.level?'filled':''}"></span>`).join('')}</div></div>`; return `<header class="header"><img id="cv-photo" src="${s(cvData.photo)}" alt="Profile" class="rounded-full object-cover"><div><h1>${s(cvData.fullName)}</h1><p class="opacity-90">${s(cvData.jobTitle)}</p></div></header><main class="main-grid"><div class="left-col"><section class="print-avoid-break"><h2>Contact</h2><div class="space-y-2 text-sm contact-list">${contactItem('email',cvData.email)}${contactItem('phone',cvData.phone)}${contactItem('location',cvData.address)}${contactItem('linkedin',cvData.linkedin)}</div></section><section class="pt-4 print-avoid-break"><h2>Skills</h2><div class="space-y-2 text-sm">${cvData.skills.map(skillDots).join('')}</div></section><section class="pt-4 print-avoid-break"><h2>Languages</h2>${cvData.languages.map(l=>`<p class="text-sm print-avoid-break">${s(l.name)} <span class="text-gray-500">- ${s(l.level)}</span></p>`).join('')}</section></div><div class="right-col"><section class="print-avoid-break"><h2>Objective</h2><p>${s(cvData.objective)}</p></section><section class="pt-4 print-avoid-break"><h2>Education</h2>${cvData.education.map(e=>`<div class="mb-3 print-avoid-break"><h3>${s(e.degree)}</h3><p class="text-sm">${s(e.institution)} | ${s(e.startDate)} - ${s(e.endDate)}</p><p class="text-xs text-gray-600">${s(e.description)}</p></div>`).join('')}</section><section class="pt-4 print-avoid-break"><h2>Experience</h2>${cvData.experience.map(e=>`<div class="mb-4 print-avoid-break"><h3>${s(e.jobTitle)}</h3><p class="text-sm font-semibold accent-text">${s(e.company)} | ${s(e.startDate)} - ${s(e.endDate)}</p><div class="text-sm mt-1 text-gray-700">${formatDescription(e.description)}</div></div>`).join('')}</section>${projectsSection(cvData.projects)}${certSection(cvData.certificates)}${interestsSection(cvData.interests)}</div></main>`; }
function renderSidebarCV() { const skillBar=(skill)=>`<div class="skill-item print-avoid-break"><span class="text-sm font-semibold">${s(skill.name)}</span><div class="level w-full rounded-full mt-1"><div class="level-fill rounded-full" style="width:${s(skill.level)*20}%"></div></div></div>`; return `<div class="sidebar"><div class="text-center mb-6"><img id="cv-photo" src="${s(cvData.photo)}" alt="Profile" class="rounded-full object-cover w-32 h-32 mx-auto border-4 border-white shadow-md"></div><div class="text-center mb-6"><h1>${s(cvData.fullName)}</h1><p id="cv-job-title" class="accent-text font-semibold">${s(cvData.jobTitle)}</p></div><section class="print-avoid-break"><h2>Contact</h2><div class="space-y-2 text-sm contact-list">${contactItem('email',cvData.email)}${contactItem('phone',cvData.phone)}${contactItem('location',cvData.address)}${contactItem('linkedin',cvData.linkedin)}</div></section><section class="pt-4 print-avoid-break"><h2>Skills</h2><div class="space-y-3">${cvData.skills.map(skillBar).join('')}</div></section><section class="pt-4 print-avoid-break"><h2>Languages</h2>${cvData.languages.map(l=>`<p class="text-sm print-avoid-break">${s(l.name)} <span class="text-gray-500">- ${s(l.level)}</span></p>`).join('')}</section>${interestsSection(cvData.interests)}</div><div class="main-content"><section class="print-avoid-break"><h2>Objective</h2><p>${s(cvData.objective)}</p></section><section class="pt-4 print-avoid-break"><h2>Education</h2>${cvData.education.map(e=>`<div class="mb-3 print-avoid-break"><h3>${s(e.degree)}</h3><p class="text-sm">${s(e.institution)} | ${s(e.startDate)} - ${s(e.endDate)}</p><p class="text-xs text-gray-600">${s(e.description)}</p></div>`).join('')}</section><section class="pt-4 print-avoid-break"><h2>Experience</h2>${cvData.experience.map(e=>`<div class="mb-4 print-avoid-break"><h3>${s(e.jobTitle)}</h3><p class="text-sm font-semibold accent-text">${s(e.company)} | ${s(e.startDate)} - ${s(e.endDate)}</p><div class="text-sm mt-1 text-gray-700">${formatDescription(e.description)}</div></div>`).join('')}</section>${projectsSection(cvData.projects)}${certSection(cvData.certificates)}</div>`; }
function renderMinimalistCV() { const contactInfo = buildContactBar([cvData.email, cvData.phone, cvData.address, cvData.linkedin], '•'); return `<header class="header"><h1>${s(cvData.fullName)}</h1><p class="font-semibold text-gray-600">${s(cvData.jobTitle)}</p><div class="contact-bar">${contactInfo}</div></header><main><section class="print-avoid-break"><h2>Objective</h2><p>${s(cvData.objective)}</p></section><section class="pt-4 print-avoid-break"><h2>Education</h2>${cvData.education.map(e=>`<div class="mb-3 print-avoid-break"><h3>${s(e.degree)}</h3><p class="text-sm">${s(e.institution)} | ${s(e.startDate)} - ${s(e.endDate)}</p></div>`).join('')}</section><section class="pt-4 print-avoid-break"><h2>Experience</h2>${cvData.experience.map(e=>`<div class="mb-4 print-avoid-break"><h3>${s(e.jobTitle)}</h3><p class="text-sm font-semibold text-gray-700">${s(e.company)} | ${s(e.startDate)} - ${s(e.endDate)}</p><div class="text-sm mt-1 text-gray-700">${formatDescription(e.description)}</div></div>`).join('')}</section>${projectsSection(cvData.projects)}<div class="grid grid-cols-2 gap-6 pt-4"><section class="print-avoid-break"><h2>Skills</h2><div class="space-y-1">${cvData.skills.map(skill=>`<p class="text-sm">${s(skill.name)}</p>`).join('')}</div></section><section class="print-avoid-break"><h2>Languages</h2>${cvData.languages.map(l=>`<p class="text-sm">${s(l.name)} (${s(l.level)})</p>`).join('')}</section></div>${certSection(cvData.certificates)}${interestsSection(cvData.interests)}</main>`; }
function renderTechnicalCV() { return `<header class="header"><div><h1>${s(cvData.fullName)}</h1><p class="accent-text">${s(cvData.jobTitle)}</p></div><div class="contact-list">${s(cvData.email)}<br>${s(cvData.phone)}<br>${s(cvData.linkedin)}</div></header><main class="mt-4"><section class="print-avoid-break"><h2>// OBJECTIVE</h2><p>${s(cvData.objective)}</p></section><section class="pt-4 print-avoid-break"><h2>// EDUCATION</h2>${cvData.education.map(e=>`<div class="mb-3 print-avoid-break"><h3>${s(e.degree)}</h3><p class="text-sm">${s(e.institution)}</p></div>`).join('')}</section><section class="pt-4 print-avoid-break"><h2>// EXPERIENCE</h2>${cvData.experience.map(e=>`<div class="mb-4 print-avoid-break"><h3>${s(e.jobTitle)} @ ${s(e.company)}</h3><p class="text-xs text-gray-500">${s(e.startDate)} - ${s(e.endDate)}</p><div class="text-sm mt-1">${formatDescription(e.description)}</div></div>`).join('')}</section>${projectsSection(cvData.projects)}<section class="pt-4 print-avoid-break"><h2>// SKILLS</h2><div class="flex flex-wrap gap-2">${cvData.skills.map(skill=>`<span class="text-sm bg-gray-100 px-2 py-1 rounded">${s(skill.name)}</span>`).join('')}</div></section>${certSection(cvData.certificates)}</main>`; }
function renderAcademicCV() { const contactInfo = buildContactBar([cvData.email, cvData.phone, cvData.address], '|'); return `<div class="font-lora"><header class="header"><h1>${s(cvData.fullName)}</h1><p class="text-gray-600">${s(cvData.jobTitle)}</p><p class="text-xs mt-2">${contactInfo}</p></header><main class="mt-4"><section class="print-avoid-break"><h2>Abstract</h2><p>${s(cvData.objective)}</p></section><section class="pt-4 print-avoid-break"><h2>Education</h2>${cvData.education.map(e=>`<div class="mb-3 print-avoid-break"><h3>${s(e.institution)}</h3><p class="text-sm">${s(e.degree)}, ${s(e.endDate)}</p></div>`).join('')}</section><section class="pt-4 print-avoid-break"><h2>Professional Experience</h2>${cvData.experience.map(e=>`<div class="mb-4 print-avoid-break"><h3>${s(e.jobTitle)}, ${s(e.company)}</h3><p class="text-sm font-semibold">${s(e.startDate)} - ${s(e.endDate)}</p><div class="text-sm mt-1">${formatDescription(e.description)}</div></div>`).join('')}</section>${projectsSection(cvData.projects)}<section class="pt-4 print-avoid-break"><h2>Skills &amp; Languages</h2><p>${cvData.skills.map(skill=>s(skill.name)).join(', ')}</p><p>${cvData.languages.map(l=>`${s(l.name)} (${s(l.level)})`).join(', ')}</p></section>${certSection(cvData.certificates)}</main></div>`; }
function renderBoldCV() { return `<header class="header text-center border-b-4 border-gray-800 pb-4 mb-4"><h1>${s(cvData.fullName)}</h1><p class="font-semibold text-xl accent-text">${s(cvData.jobTitle)}</p></header><main><section class="print-avoid-break"><h2>Objective</h2><p>${s(cvData.objective)}</p></section><section class="pt-4 print-avoid-break"><h2>Education</h2>${cvData.education.map(e=>`<div class="mb-3 print-avoid-break"><h3>${s(e.degree)}</h3><p class="text-sm">${s(e.institution)}</p></div>`).join('')}</section><section class="pt-4 print-avoid-break"><h2>Experience</h2>${cvData.experience.map(e=>`<div class="mb-4 print-avoid-break"><h3>${s(e.jobTitle)}</h3><p class="text-sm font-semibold">${s(e.company)} | ${s(e.startDate)} - ${s(e.endDate)}</p><div class="text-sm mt-1">${formatDescription(e.description)}</div></div>`).join('')}</section>${projectsSection(cvData.projects)}<div class="grid grid-cols-2 gap-6 pt-4"><section class="print-avoid-break"><h2>Skills</h2><div class="space-y-1">${cvData.skills.map(skill=>`<p class="text-sm">${s(skill.name)}</p>`).join('')}</div></section>${certSection(cvData.certificates)}</div>${interestsSection(cvData.interests)}</main>`; }
function renderTimelineCV() { return `<header class="text-center mb-6"><h1>${s(cvData.fullName)}</h1><p class="font-semibold text-gray-600">${s(cvData.jobTitle)}</p></header><main class="timeline-container"><section class="print-avoid-break timeline-item"><h2>Education</h2>${cvData.education.map(e=>`<div class="mb-3 print-avoid-break"><h3>${s(e.degree)}</h3><p class="text-sm">${s(e.institution)}</p></div>`).join('')}</section><section class="pt-4 print-avoid-break timeline-item"><h2>Experience</h2>${cvData.experience.map(e=>`<div class="mb-4 print-avoid-break"><h3>${s(e.jobTitle)} at ${s(e.company)}</h3><p class="text-xs text-gray-500">${s(e.startDate)} - ${s(e.endDate)}</p><div class="text-sm mt-1">${formatDescription(e.description)}</div></div>`).join('')}</section>${projectsSection(cvData.projects)}<section class="pt-4 print-avoid-break timeline-item"><h2>Skills</h2><p>${cvData.skills.map(skill=>s(skill.name)).join(', ')}</p></section>${certSection(cvData.certificates)}${interestsSection(cvData.interests)}</main>`; }
function renderCorporateCV() { const skillBar=(skill)=>`<div class="skill-item print-avoid-break"><span class="text-sm font-semibold">${s(skill.name)}</span><div class="level w-full rounded-full mt-1"><div class="level-fill rounded-full" style="width:${s(skill.level)*20}%"></div></div></div>`; const contactInfo = buildContactBar([cvData.email, cvData.phone, cvData.linkedin], '•'); return `<header class="header"><h1>${s(cvData.fullName)}</h1><p>${s(cvData.jobTitle)}</p><div class="flex gap-4 text-xs mt-2">${contactInfo}</div></header><main class="main-grid"><div class="left-col"><section class="print-avoid-break"><h2>Objective</h2><p>${s(cvData.objective)}</p></section><section class="pt-4 print-avoid-break"><h2>Education</h2>${cvData.education.map(e=>`<div class="mb-3 print-avoid-break"><h3>${s(e.degree)}</h3><p class="text-sm">${s(e.institution)}</p></div>`).join('')}</section><section class="pt-4 print-avoid-break"><h2>Experience</h2>${cvData.experience.map(e=>`<div class="mb-4 print-avoid-break"><h3>${s(e.jobTitle)}</h3><p class="text-sm font-semibold accent-text">${s(e.company)} | ${s(e.startDate)} - ${s(e.endDate)}</p><div class="text-sm mt-1 text-gray-700">${formatDescription(e.description)}</div></div>`).join('')}</section>${projectsSection(cvData.projects)}</div><div class="right-col"><section class="print-avoid-break"><h2>Skills</h2><div class="space-y-3">${cvData.skills.map(skillBar).join('')}</div></section>${certSection(cvData.certificates)}<section class="pt-4 print-avoid-break"><h2>Languages</h2>${cvData.languages.map(l=>`<p class="print-avoid-break">${s(l.name)} <span class="text-gray-500">- ${s(l.level)}</span></p>`).join('')}</section>${interestsSection(cvData.interests)}</div></main>`; }

// --- START THE APP ---
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
